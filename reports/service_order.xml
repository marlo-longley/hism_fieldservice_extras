<?xml version="1.0"?>
<odoo>
    <!-- Inherit service order report (from module fieldservice) -->
    <template id="hism_service_order_report" inherit_id="fieldservice.report_fsm_order_document">
        <!-- Hook into the parent form's page element and replace it-->
        <xpath expr="//div[@class='page']" position="replace">
            <div class="page">
                <div class="oe_structure"/>
                <hr/>
                <h2>
                    FS Order #
                    <span t-field="doc.name"/>
                    <t t-if="doc.template_id">(<span t-field="doc.template_id.name"/>)
                    </t>
                </h2>
                <div>
                    <t t-if="doc.stage_id.name == 'Scheduled'">
                        <div t-if="doc.stage_id">
                            <strong>ETA:</strong>
                            <span t-field="doc.scheduled_date_start"
                                  t-options="{'widget': 'datetime', 'tz': doc.location_id.tz}"/>
                        </div>
                    </t>
                    <div t-if="doc.person_id">
                        <strong>Assigned To:</strong>
                        <span t-field="doc.person_id"/>
                    </div>
                </div>
                <hr/>
                <div t-if="doc.description" id="description">
                    <h3>Description</h3>
                    <p t-field="doc.description"/>
                </div>

                <div t-if="doc.todo" id="instruction">
                    <h3>Instructions</h3>
                    <p t-raw="doc.todo"/>
                </div>
                <div t-if="doc.resolution" id="resolution">
                    <h3>Resolution Notes</h3>
                    <p t-field="doc.resolution"/>
                </div>
                <!-- Table showing tasks and results -->
                <div t-if="doc.order_activity_ids" id="activities">
                    <t t-set="activity_data" t-value="doc.get_activity_data()"/>
                    <table class="table">
                        <thead class="thead-dark">
                            <tr>
                                <th scope="col">Test Name</th>
                                <th scope="col">Tested After Service?</th>
                                <th scope="col">Completed On</th>
                                <th scope="col">Score</th>
                                <th scope="col">Notes</th>
                            </tr>
                        </thead>

                        <tbody>
                            <t t-foreach="activity_data" t-as="task">
                                <tr>
                                    <td>
                                        <t t-esc="task['name']"/>
                                    </td>
                                    <td>
                                        <p t-if="task['after']">True</p>
                                        <p t-else="">False</p>
                                    </td>
                                    <td>
                                        <t t-esc="task['completed_on']"/>
                                    </td>
                                    <td>
                                        <p t-if="(task['score'] != 0.00)"><t t-esc="task['score']"/></p>
                                        <p t-else="">N/A</p>
                                    </td>
                                    <td>
                                        <t t-esc="task['notes']"/>
                                    </td>
                                </tr>
                            </t>
                        </tbody>
                    </table>
                </div>

                <div class="oe_structure"/>
            </div>
        </xpath>
    </template>
</odoo>

